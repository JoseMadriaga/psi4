#! MBIS calculation on PhO-

charges_ref = psi4.Matrix.from_list([   #TEST
[-0.858485822012895],
[0.5998450612981072],
[-0.4191630772474415],
[-0.0359028037964908],
[-0.34554170341395807],
[-0.042762848297899225],
[-0.4009496646572668],
[0.12593423580646457],
[0.07712908145948338],
[0.09391074550375189],
[0.07590944077018147],
[0.13003683303642133]
])

dipoles_ref = psi4.Matrix.from_list([   #TEST
[0.010731515478764192, 0.028673936746991032, -0.011471956032960138],
[0.045434117763501994, 0.07710789765286881, -0.019371910572894023],
[0.02584733757312849, 0.0026553541481417497, 0.01444702319522721],
[-0.006529178050921994, 0.0028531131276871343, -0.005974803406986586],
[0.0027343860746742357, 0.010775733451042439, -0.005087096762135483],
[0.00599398267522539, -0.008662427114994622, 0.00917213239204749],
[-0.01144295244520157, 0.021457368368808682, -0.02072473542223603],
[0.039893637114591776, 0.01551959930175297, 0.015546513770480358],
[0.023851644481045403, -0.03277987012075149, 0.03485749838611449],
[-0.02312969963968581, -0.03991048371377961, 0.00998925521940178],
[-0.04648344316308301, -0.006873250800959441, -0.024742931957818702],
[-0.00826975626687483, 0.03671943776014707, -0.027776137446539662]
])

quadrupoles_ref = psi4.Matrix.from_list([                                             #TEST
[-4.761132381219476, 0.04977660183042222, -0.043296087947945906, -4.666386788120084, -0.015387843183390775, -4.758584211148839],
[-3.488201241995111, -0.009616730403345635, -0.10479870473594462, -3.4423913692554113, 0.07566989463381946, -3.4225514053004065],
[-5.133250079895075, 0.016000033443978205, -0.02755114019880671, -5.2186385625432905, 0.07935897665019886, -5.171053119717821],
[-4.610377675781185, -0.09442762783262763, -0.033180445917077306, -4.573827016879189, 0.007999048388802369, -4.489967910241171],
[-5.152698603117936, 0.04231353555658345, -0.057708675310049806, -5.0773925993205316, 0.011289030930112194, -5.145038261690012],
[-4.519699138945015, -0.024661222522144075, -0.01240122832621254, -4.647905748820347, 0.09037023788221477, -4.53831517652833],
[-5.199527460528324, -0.062403400022211425, -0.056506362177913716, -5.112346925360568, 0.0003881206339392041, -5.083591733252629],
[-0.5160109856578284, 0.003303531117602354, -0.0003638593242042333, -0.49335431804470276, -0.013420112734314165, -0.510592072767336],
[-0.5327454714742434, 0.014166116359287412, 0.003048925351873229, -0.5429327630556292, 0.0036371028194095195, -0.5517895750460292],
[-0.531419167412258, -0.005404938656851767, 0.018518959529310985, -0.5475449556161398, -0.008419037620718772, -0.5391375981847651],
[-0.5553823074700417, -0.0002467397591516724, -0.0011246193233336748, -0.5318077166825875, -0.013350979255823818, -0.5458708243924166],
[-0.49401123620250986, 0.013741845924670591, 0.0025755842375694334, -0.49895576246501905, 0.0007302242209263497, -0.5105430356655178]
])

octupoles_ref = psi4.Matrix.from_list([                                              #TEST
[0.06843614429143546, 0.10414269758594999, -0.057057705379756955, 0.17910792383924054, -0.06993693334620073, 0.05073735527335703, 0.4208759134070282, -0.06683810087918236, 0.048952422473408135, -0.04830288123818521],
[0.24418413542151995, 0.05404188712953351, 0.058223069126182365, -0.15207908705778345, 0.09959949507151497, 0.040855458193262174, 0.022917418127666036, 0.004916511849377713, 0.13489013290920035, -0.1123705081801784],
[-0.15713832175700176, 0.014034966080963893, -0.14339677026807102, 0.24377229210070422, -0.1931743106156466, 0.0898572265597893, 0.2961889307885933, 0.10888094395414757, -0.10642813076180911, 0.019077332837953164],
[0.24065599445027272, 0.009523519521824602, 0.1406403889708439, -0.19739553523999673, 0.1492464637780464, -0.013981981390681004, -0.19466076378422084, -0.044991096001431564, 0.10122364667521311, -0.02713168970698231],
[-0.2870191021592893, -0.04597396989580236, -0.16749874357870317, 0.21179588035986496, -0.17492966216091851, 0.02587604308489439, 0.12904107092248182, 0.10091943714903581, -0.14131069809009164, 0.06936668869157728],
[0.16209790733232673, 0.011340668454506653, 0.13527834901914773, -0.22377323731189663, 0.1450823089513588, -0.037713342014603315, -0.1743907653796283, -0.07410236166996108, 0.10234659363445592, -0.08509469979541466],
[-0.19176428509251653, -0.009719654127203329, -0.23983641536517938, 0.22862287132296935, -0.1528446568706266, 0.04831113594651419, 0.29239470747088064, 0.09719353521395875, -0.04899080768100576, 0.0486892976554911],
[0.009515612504021236, 0.004332923242206283, -0.004872681730277619, 0.006794454885627269, -0.0033614014216417644, 0.006608044385151278, 0.017046069086751978, 0.005431449283144093, 0.0029888836385848785, -0.0009759755558313897],
[0.019454546919891725, -0.003414075331683237, 0.00875045831524294, -0.0020014350483204915, 0.0041983327042995865, 0.004094600110985458, -0.015386446054845775, 0.0033594800232260706, -0.00022155304134660722, 0.012766826415091994],
[-0.016947486101833123, -0.0058319820827833465, 7.845440547805744e-05, 0.0030803359992542596, -0.003302502205607536, -0.004876117264674396, -0.015239920514745946, 4.309718928731977e-05, -0.009976332253756574, 0.007097853278108625],
[-0.011947557449191461, 0.000709664160574365, -6.199585813068557e-06, -0.012236092816207423, 0.004395808133970534, -0.006736548175348438, -0.004279095694139479, -0.0055978228441850904, 0.0034814418225084863, -0.013552330132337722],
[0.003267259820992394, 0.0022818920865806673, -0.008251295971852812, 0.0033314006118992092, -0.0035434874364256514, 0.005888798345576382, 0.024396332466183567, 0.001438262179697754, 0.006878243253935223, -0.006186808369070982]
])

molecule mol {
-1 1
O    -1.3885044    1.9298523   -0.4431206
C    -2.0071056    0.7638459   -0.1083509
C    -1.4630807   -0.1519120    0.7949930
C    -2.1475789   -1.3295094    1.0883677
C    -3.3743208   -1.6031427    0.4895864
C    -3.9143727   -0.6838545   -0.4091028
C    -3.2370496    0.4929609   -0.7096126
H    -0.5106510    0.0566569    1.2642563
H    -1.7151135   -2.0321452    1.7878417
H    -3.9024664   -2.5173865    0.7197947
H    -4.8670730   -0.8822939   -0.8811319
H    -3.6431662    1.2134345   -1.4057590
  symmetry c1
  no_reorient
  no_com
}

set {
  scf_type df
  d_convergence 8
  e_convergence 10
  mbis_maxiter 500
  mbis_d_convergence 1e-8
  dft_pruning_scheme none
  dft_radial_points 99
  dft_spherical_points 590
}

e, wfn = energy('hf/cc-pvdz', return_wfn=True)
oeprop(wfn, 'MBIS_CHARGES', title='PhO- SCF')

charges = wfn.variable('MBIS_CHARGES')
dipoles = wfn.variable('MBIS_DIPOLES')
quadrupoles = wfn.variable('MBIS_QUADRUPOLES')
octupoles = wfn.variable('MBIS_OCTUPOLES')

compare_matrices(charges_ref, charges, 3, "MBIS Charges")             #TEST
compare_matrices(dipoles_ref, dipoles, 3, "MBIS Dipoles")             #TEST
compare_matrices(quadrupoles_ref, quadrupoles, 3, "MBIS Quadrupoles") #TEST
compare_matrices(octupoles_ref, octupoles, 3, "MBIS Octupoles")       #TEST
