#! MBIS calculation on NaF

charges_ref = psi4.Matrix.from_list([   #TEST
       [0.9259895033498928],
       [-0.9259902818594217]
])

dipoles_ref = psi4.Matrix.from_list([   #TEST
       [-4.01224271156056e-08, 2.1633742976252345e-07, -0.07616533536527087],
       [4.655296666028173e-07, -7.597934712998314e-07, 0.17951471104887093]
])

quadrupoles_ref = psi4.Matrix.from_list([                                             #TEST
       [-2.6134518268117315, 6.067513910976911e-08, -5.766354210201405e-08, -2.6134518687184785, 6.983944420831592e-07, -2.5217233596726625],
       [-4.641708433499064, -6.637236253036311e-08, -1.5879234725000125e-06, -4.6417084187864806, 2.656909435019602e-06, -4.449142288820762]
])

octupoles_ref = psi4.Matrix.from_list([                                              #TEST
       [-4.287845366064219e-07, 1.149743581939458e-07, -0.7558262293705084, -9.615827257202206e-08, 1.7559022889586273e-09, -1.4543105322553238e-07, -1.9256192269169778e-07, -0.7558265470055916, 2.204932351570103e-06, -1.3142065418859463],
       [3.8726208090429673e-07, -1.0402521300503431e-07, 0.4386037556027507, 1.4833323593906134e-07, 1.7537750812103943e-07, 5.444182501569543e-06, -1.831596319893853e-07, 0.4386038159312605, -9.293794185463345e-06, 0.5708827793209308]
])

molecule mol {
  0 1
  Na 0.00 0.00 0.00
  F  0.00 0.00 1.93
  symmetry c1
  no_reorient
  no_com
}

set {
  scf_type df
  d_convergence 8
  e_convergence 10
  mbis_maxiter 500
  mbis_d_convergence 1e-8
  dft_pruning_scheme none
  dft_radial_points 99
  dft_spherical_points 590
  debug 1
}

e, wfn = energy('hf/cc-pvdz', return_wfn=True)
oeprop(wfn, 'MBIS_CHARGES', title='NaF SCF')

charges = wfn.variable('MBIS_CHARGES')
dipoles = wfn.variable('MBIS_DIPOLES')
quadrupoles = wfn.variable('MBIS_QUADRUPOLES')
octupoles = wfn.variable('MBIS_OCTUPOLES')

compare_matrices(charges_ref, charges, 3, "MBIS Charges")             #TEST
compare_matrices(dipoles_ref, dipoles, 3, "MBIS Dipoles")             #TEST
compare_matrices(quadrupoles_ref, quadrupoles, 3, "MBIS Quadrupoles") #TEST
compare_matrices(octupoles_ref, octupoles, 3, "MBIS Octupoles")       #TEST
