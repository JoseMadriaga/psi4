#! MBIS calculation on NaCl

charges_ref = psi4.Matrix.from_list([   #TEST
       [0.9652284267788502],
       [-0.9652232263126841]
])

dipoles_ref = psi4.Matrix.from_list([   #TEST
       [-8.67800747e-08, -2.13601690e-07, -9.81430719e-03],
       [-1.66602523e-07,  8.90379573e-07,  6.42299408e-01]
])

quadrupoles_ref = psi4.Matrix.from_list([                                             #TEST
       [-2.34996073e+00,  1.97783546e-07, -5.72925192e-08, -2.34996101e+00,
       -6.08075354e-07, -2.28983041e+00],
       [-1.18920056e+01,  1.99095255e-06,  1.12442102e-06, -1.18920051e+01,
       -4.80526581e-06, -1.20795669e+01]
])

octupoles_ref = psi4.Matrix.from_list([                                              #TEST
       [-3.42141731e-06,  6.43519504e-07, -2.56169229e-02,  5.27278001e-07,
        4.34173753e-07,  1.91779338e-06, -2.39008275e-06, -2.56175938e-02,
       -1.81582957e-06, -5.92800707e-02],
       [ 6.13150523e-06,  1.69532183e-06,  2.25694966e+00,  7.96264218e-07,
       -1.12353053e-05, -7.37577162e-06,  5.09052751e-06,  2.25695042e+00,
        2.51572796e-05,  4.56842274e+00]
])

molecule {
0 1
Na 0.00 0.00 0.00
Cl 0.00 0.00 2.36
symmetry c1
no_reorient
no_com
}

set {
  reference rhf
  scf_type df
  d_convergence 8
  e_convergence 10
  mbis_maxiter 500
  mbis_d_convergence 1e-8
  dft_radial_points 99
  dft_spherical_points 590
  debug 1
}

e, wfn = energy('hf/cc-pvdz', return_wfn=True)
oeprop(wfn, 'MBIS_CHARGES', title='NaCl SCF')

charges = wfn.variable('MBIS_CHARGES')
dipoles = wfn.variable('MBIS_DIPOLES')
quadrupoles = wfn.variable('MBIS_QUADRUPOLES')
octupoles = wfn.variable('MBIS_OCTUPOLES')

compare_matrices(charges_ref, charges, 3, "MBIS Charges")             #TEST
compare_matrices(dipoles_ref, dipoles, 3, "MBIS Dipoles")             #TEST
compare_matrices(quadrupoles_ref, quadrupoles, 3, "MBIS Quadrupoles") #TEST
compare_matrices(octupoles_ref, octupoles, 2.5, "MBIS Octupoles")       #TEST
